<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punku Chat Widget Demo</title>
</head>
<body style="width: 100vh; height: 100vh; background-color: #f5f5f5;">
    <h1 style="font-family: system-ui, -apple-system, sans-serif; padding: 20px;">Punku Chat Widget</h1>
    <p style="font-family: system-ui, -apple-system, sans-serif; padding: 0 20px;">This demonstrates the chat widget integration.</p>

    <punku-chat
        window_title="Support Assistant"
        welcome_message="Hello! How can I help you today?"
        flow_id="YOUR_FLOW_ID"
        host_url="https://app.punku.ai"
        theme="punku-ai-bookingkit"
        api_key="YOUR_API_KEY"
        start_open="false"
    ></punku-chat>
    
    
    <script>
        // Wait for the widget to load
        function waitForWidget() {
            return new Promise((resolve) => {
                const checkWidget = () => {
                    if (window['punku-chat-widget_api']) {
                        resolve(window['punku-chat-widget_api']);
                    } else {
                        setTimeout(checkWidget, 100);
                    }
                };
                checkWidget();
            });
        }
        
        // Update status display
        function updateStatus(message) {
            const statusDiv = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            if (statusDiv) {
                statusDiv.innerHTML = `[${timestamp}] ${message}`;
            } else {
                console.log(`[${timestamp}] ${message}`);
            }
        }
        
        // Programmatic control functions
        async function openChat() {
            try {
                const widget = await waitForWidget();
                widget.open();
                updateStatus('‚úÖ Chat opened programmatically');
            } catch (error) {
                updateStatus('‚ùå Error opening chat: ' + error.message);
            }
        }
        
        async function closeChat() {
            try {
                const widget = await waitForWidget();
                widget.close();
                updateStatus('‚úÖ Chat closed programmatically');
            } catch (error) {
                updateStatus('‚ùå Error closing chat: ' + error.message);
            }
        }
        
        async function checkStatus() {
            try {
                const widget = await waitForWidget();
                const isOpen = widget.isOpen();
                updateStatus(`üìä Status - Open: ${isOpen}`);
            } catch (error) {
                updateStatus('‚ùå Error checking status: ' + error.message);
            }
        }
        
        // Auto-test when page loads
        window.addEventListener('load', async function() {
            updateStatus('üöÄ Page loaded - testing widget connection...');
            
            try {
                const widget = await waitForWidget();
                updateStatus('‚úÖ Widget API loaded successfully! Ready to test programmatic control.');

                checkStatus();
                
                // Test sequence: Open -> Wait -> Close -> Wait -> Open again
                setTimeout(() => {
                    updateStatus('üîÑ Auto-opening chat in 2 seconds...');
                }, 1000);
                
                setTimeout(() => {
                    widget.open();
                    updateStatus('‚úÖ Auto-opened chat successfully!');
                }, 3000);
                
                // Close after 5 seconds
                setTimeout(() => {
                    updateStatus('üîÑ Auto-closing chat in 2 seconds...');
                }, 5000);
                
                setTimeout(() => {
                    widget.close();
                    updateStatus('‚úÖ Auto-closed chat successfully!');
                }, 7000);
                
            } catch (error) {
                updateStatus('‚ùå Error loading widget API: ' + error.message);
            }
        });
        
    </script>
</body>
</html>